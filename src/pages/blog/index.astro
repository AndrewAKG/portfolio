---
import { getCollection, render } from 'astro:content';
import BaseHead from '../../components/BaseHead.astro';
import Footer from '../../components/sections/Footer.astro';
import Header from '../../components/sections/Header.astro';
import HeroSection from '../../components/sections/HeroSection.astro';
import BlogAllArticles from '../../components/sections/BlogAllArticles.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../../consts';
import FeaturedPost from '../../components/ui/card/FeaturedPost.astro';
import { calculateReadingTimeFromHtml } from '../../lib/reading';

const posts = (await getCollection('blog')).sort((a,b)=>+b.data.pubDate-+a.data.pubDate);
const [featured, ...rest] = posts;
let featuredReading = 0;
if (featured) {
  const { Content } = await render(featured);
  const html = await Astro.slots.render('default');
  featuredReading = calculateReadingTimeFromHtml(html ?? '');
}
---

<!doctype html>
<html lang="en" data-theme="dark" class="dark">
	<head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
	</head>
	<body>
        <Header />
        <HeroSection title="Blog" />
        <main class="use-utility-layout mx-auto max-w-5xl px-3 py-5 space-y-7">
            {featured && (
              <section class="card-surface p-4 md:p-5 hover-lift sw-featured-card">
                <FeaturedPost post={featured} readingTimeMin={featuredReading} />
              </section>
            )}

            <BlogAllArticles posts={rest} />
        </main>
        <Footer />
	</body>
</html>
